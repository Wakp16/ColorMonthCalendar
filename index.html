<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Momentum</title>

  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#000000">

  <script src="https://cdn.jsdelivr.net/npm/fullcalendar/index.global.min.js"></script>
  <style>
    body {
      margin:0;
      display:flex;
      height:100vh;
      background:#000;
      color:#fff;
      font-family:Arial,sans-serif;
    }

    .sidebar {
      width:220px;
      border-right:1px solid #222;
      padding:14px;
    }

    .page {
      padding:10px;
      margin-bottom:8px;
      background:#111;
      border-radius:10px;
      cursor:pointer;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }

    .page.active { outline:2px solid #fff; }

    .page-buttons { display:flex; gap:4px; }

    .edit-btn, .delete-btn {
      background:#444;
      color:#fff;
      border:none;
      border-radius:6px;
      padding:2px 6px;
      cursor:pointer;
      font-size:12px;
      box-shadow:0 0 6px #888;
      transition:0.2s;
    }
    .edit-btn:hover, .delete-btn:hover { box-shadow:0 0 12px #fff; }

    .add-page {
      margin-top:12px;
      padding:10px;
      background:#00ff66;
      color:#000;
      border-radius:12px;
      text-align:center;
      cursor:pointer;
      font-weight:bold;
      box-shadow:0 0 6px #00ff66;
      transition:0.2s;
    }
    .add-page:hover { box-shadow:0 0 12px #00ff66; }

    .main { flex:1; padding:14px; }

    #calendar {
      width:100%;
      height:100%;
      background:#000;
      border-radius:16px;
      padding:10px;
      border:1px solid #222;
    }

    .controls {
      margin-top:14px;
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }

    input {
      padding:8px 10px;
      background:#000;
      color:#fff;
      border:1px solid #444;
      border-radius:10px;
      box-shadow:0 0 6px #888;
      transition:0.2s;
    }
    input:focus { box-shadow:0 0 12px #fff; outline:none; }

    button {
      padding:8px 14px;
      border:none;
      cursor:pointer;
      border-radius:12px;
      font-weight:bold;
      box-shadow:0 0 6px #888;
      transition:0.2s;
    }
    button:hover { box-shadow:0 0 14px #fff; }

    .green { background:#00ff66; color:#000; }
    .red { background:#ff3b3b; color:#000; }
    .reset { background:#ff00ff; color:#fff; }
    .clear-color { background:#ffaa00; color:#000; }

    .fc-daygrid-event {
      display:block;
      width:100%;
      height:100%;
      border-radius:12px;
      text-align:center;
      color:#000 !important;
      font-weight:bold;
    }

    .fc-daygrid-day:hover {
      outline:4px solid #fff;
      border-radius:12px;
      cursor:pointer;
      box-shadow:0 0 16px #888;
    }

    .fc-daygrid-day.selected {
      box-shadow:0 0 20px 5px purple;
      border-radius:12px;
      border:4px solid purple;
    }

    .fc-day-other { display:none !important; }
  </style>
</head>
<body>
  <div class="sidebar">
    <div id="pages"></div>
    <div class="add-page" onclick="addPage()">+ Add Page</div>
  </div>

  <div class="main">
    <div id="calendar"></div>
    <div class="controls">
      <input id="label" placeholder="Day label" />
      <button class="green" onclick="markDay('green')">Green</button>
      <button class="red" onclick="markDay('red')">Red</button>
      <button class="clear-color" onclick="clearDayColor()">Remove Color</button>
      <button class="reset" onclick="resetCalendar()">Reset</button>
    </div>
  </div>

  <script>
    // PWA Service Worker registration
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./service-worker.js', {scope: './'})
        .then(() => console.log('Service Worker Registered'))
        .catch(err => console.log('Service Worker registration failed:', err));
    }

    let currentPage = localStorage.getItem('currentPage') || 'Page 1';
    let pages = JSON.parse(localStorage.getItem('pages')) || ['Page 1'];
    let pageData = JSON.parse(localStorage.getItem('pageData')) || {};
    if (!pageData[currentPage]) pageData[currentPage] = {};
    let selectedDate = null;
    let lastCell = null;
    let calendar;

    function saveData() {
      localStorage.setItem('pageData', JSON.stringify(pageData));
      localStorage.setItem('pages', JSON.stringify(pages));
      localStorage.setItem('currentPage', currentPage);
    }

    function renderPages() {
      const container = document.getElementById('pages');
      container.innerHTML = '';
      pages.forEach(p => {
        const div = document.createElement('div');
        div.className = 'page' + (p === currentPage ? ' active' : '');
        div.innerHTML = `<span>${p}</span> <div class='page-buttons'><button class='edit-btn' onclick='renamePage("${p}")'>âœŽ</button><button class='delete-btn' onclick='deletePage("${p}")'>ðŸ—‘</button></div>`;
        div.onclick = () => switchPage(p);
        container.appendChild(div);
      });
    }

    function switchPage(page) {
      currentPage = page;
      if (!pageData[currentPage]) pageData[currentPage] = {};
      saveData();
      renderCalendar();
      renderPages();
    }

    function addPage() {
      const name = prompt('Page name');
      if (!name || pages.includes(name)) return;
      pages.push(name);
      currentPage = name;
      pageData[currentPage] = {};
      saveData();
      renderPages();
      renderCalendar();
    }

    function renamePage(oldName) {
      const newName = prompt('Rename page', oldName);
      if (!newName || pages.includes(newName)) return;
      const idx = pages.indexOf(oldName);
      pages[idx] = newName;
      pageData[newName] = pageData[oldName];
      delete pageData[oldName];
      if (currentPage === oldName) currentPage = newName;
      saveData();
      renderPages();
      renderCalendar();
    }

    function deletePage(name) {
      if (!confirm(`Are you sure you want to delete page '${name}'?`)) return;
      const idx = pages.indexOf(name);
      if (idx > -1) pages.splice(idx, 1);
      delete pageData[name];
      if (currentPage === name) currentPage = pages[0] || null;
      saveData();
      renderPages();
      renderCalendar();
    }

    function resetCalendar() {
      if (!confirm('Are you sure you want to reset this page?')) return;
      pageData[currentPage] = {};
      saveData();
      renderCalendar();
    }

    function clearDayColor() {
      if (!selectedDate) return;
      delete pageData[currentPage][selectedDate];
      saveData();
      renderCalendar();
    }

    function renderCalendar() {
      if (calendar) calendar.destroy();
      calendar = new FullCalendar.Calendar(document.getElementById('calendar'), {
        initialView: 'dayGridMonth',
        showNonCurrentDates: false,
        dateClick(info) {
          selectedDate = info.dateStr;
          if (lastCell) lastCell.classList.remove('selected');
          const cell = info.dayEl;
          if (cell) { cell.classList.add('selected'); lastCell = cell; }
        },
        events: Object.values(pageData[currentPage] || {}),
        eventDidMount: function(info) {
          const cell = info.el.closest('.fc-daygrid-day');
          if (cell) {
            cell.style.backgroundColor = info.event.backgroundColor;
            cell.style.borderRadius='12px';
          }
        }
      });
      calendar.render();
    }

    function markDay(color) {
      if (!selectedDate) return;
      const label = document.getElementById('label').value;
      const bg = color === 'green' ? '#00ff66' : '#ff3b3b';
      pageData[currentPage][selectedDate] = { title: label, start: selectedDate, backgroundColor:bg, borderColor:bg };
      saveData();
      renderCalendar();
    }

    document.addEventListener('DOMContentLoaded', () => {
      if (!pageData[currentPage]) pageData[currentPage] = {};
      renderPages();
      renderCalendar();
    });
  </script>
</body>
</html>
